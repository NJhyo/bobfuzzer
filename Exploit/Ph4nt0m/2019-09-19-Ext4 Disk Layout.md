---
title: Ext4 Disk Layout
description: Ext4 disk layout description
header: Ext4 Disk Layout
---

### 1. Description
1.ext4 Disk Layout

|   |   |  | | |
|---|---|---|---|---|
| `Block Group 1` | `Block Group 2` | `Block Group 3` | `...` | `Block Group N` |

이런 모양과 같이 하나의 디스크를 여러개의 Block Group 으로 나눈다. 보통 하나의 Block Group은 128M가 할당 된다.

2.ext4 Block Layout

|  |  |  |  |  |  | |
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| `Super Block` | `GDTs` | `Reserved GDTs` | `Block Bitmap` | `Inode Bitmap` | `Inode Table` | `DATA` |
| `1 Block` | `N Blocks` | `N Blocks` | `1 Block` | `1 Block` | `N Blocks` | `N Blocks` |

모든 블록 그룹은 이런 형태의 블록 으로 구성된다.
Block Group의 전체정보를 가지는 Super Block과 GDTs, Reserved GDTs를 가지게 되는데 이 정보들은 주로 Block Group 0번의 것을 사용하지만 백업용으로 다른 Block Group들에도 존재한다. 이 것 이외에 Block Bitmap, Inode Bitmap, Inode Table, Data 영역은 각 Block Group 단위로 관리되는 정보들이다. 이 때 보면 Block Bitmap, Inode Bitmap은 하나의 Block만 할당 받기 때문에 Block의 크기가 4KB라면 bit단위로 32k개를 관리 할 수 있다. 그래서 32K * 4K 해서 하나의 Block Group의 크기가 128MB로 설정되게 된다.

하지만 EXT라는 파일시스템은 생각보다 작은 단위로 파일을 관리한다. 그래서 Ext4로 발전해 오면서 Flexible Block Group이라는 특성을 사용하기 시작한다.

***FLEX_BG 특성을 사용하면 Block Group 0번이 2^log_group_per_flex 만큼의 관리 정보를 모두 가지게 된다.
만약 log_group_per_flex가 3이면 8개의 Block Group이 하나로 관리되게 된다.***

|  |  |  |  |  |  | |
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| `Super Block` | `GDTs` | `Reserved GDTs` | `Block Bitmap` | `Inode Bitmap` | `Inode Table` | `DATA` |
| `1 Block` | `N Blocks` | `N Blocks` | `8 Block` | `8 Block` | `N * 8 Blocks` | `N * 8 Blocks` |

기존의 Block Bitmap, Inode Bitmap, Inode Table 영역들이 연결되는 형태로 들어가게 된다.
Block Group 0번에 다른 Block Group 들이 메타정보(Bitmap, table) 들이 다 넘어오게 되는 것이다.

그러나 EXT4에서 무조건 사용하는 것이 아니라 Header에 FLEX_BG라는 Flag가 설정되어 있어야만 Flexible Block Group을 사용 가능하다. Flag가 꺼져있다면 예전 방식대로 처리해야만 한다.


3. Data Management
ext4가 들어오면서 데이터 영역을 관리하는 방법 또한 바뀌었다.
보통 파일의 종류에 따라서 File/Directory에서 File이면, 실제 데이터 영역에 파일의 내용이 있고, Directory면 해당 디렉토리 에 있는 파일 목록에 대한 정보가 데이터 영역에 관리가 되게 된다.
